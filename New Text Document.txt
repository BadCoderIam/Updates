# Required: Microsoft.Graph module
# Install if needed: Install-Module Microsoft.Graph -Scope CurrentUser

# Connect to Graph with required scopes
Connect-MgGraph -Environment USGov -Scopes "User.ReadWrite.All", "GroupMember.Read.All"

# Get the group
$group = Get-MgGroup -Filter "DisplayName eq 'DYN-ActiveUsers'"

# Set the same photo for every member
Get-MgGroupMember -GroupId $group.Id -All | ForEach-Object {
    if ($_.AdditionalProperties['@odata.type'] -eq '#microsoft.graph.user') {
        $userUPN = $_.AdditionalProperties['userPrincipalName']
        Set-MgUserPhotoContent -UserId $userUPN -InFile "C:\scripts\picture.png"
        Write-Host "âœ… Photo set for $userUPN"
    }
}
